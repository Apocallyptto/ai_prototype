diff --git a/requirements.txt b/requirements.txt
index 5c154f2..46d849b 100644
--- a/requirements.txt
+++ b/requirements.txt
@@ -1,11 +1,11 @@
 # --- core ---
-pandas
+pandas==2.3.3
 numpy
 psycopg2-binary
 SQLAlchemy>=2.0
 
 # --- ML ---
-scikit-learn
+scikit-learn==1.7.2
 joblib
 
 # --- data sources ---
@@ -16,8 +16,6 @@ yfinance
 streamlit
 plotly
 
-alpaca-py
-alpaca-trade-api
 # --- HTTP stack (pin to avoid urllib3/six breakage) ---
 requests==2.31.0
 urllib3==1.26.18
@@ -25,4 +23,3 @@ six==1.16.0
 certifi>=2024.7.4
 charset-normalizer>=3.3.2
 idna>=3.7
-scikit-learn==1.7.2
\ No newline at end of file
diff --git a/services/signal_executor.py b/services/signal_executor.py
index 946c545..9674896 100644
--- a/services/signal_executor.py
+++ b/services/signal_executor.py
@@ -102,6 +102,7 @@ class Cfg:
 
     trade_only_when_market_open: bool
     preopen_window_seconds: int
+    allow_trade_on_clock_error: bool
 
     trading_paused: bool
     dry_run: bool
@@ -134,6 +135,7 @@ def load_cfg() -> Cfg:
         pick_ttl_seconds=_env_int("PICK_TTL_SECONDS", 120),
         trade_only_when_market_open=_env_bool("TRADE_ONLY_WHEN_MARKET_OPEN", True),
         preopen_window_seconds=_env_int("PREOPEN_WINDOW_SECONDS", 0),
+        allow_trade_on_clock_error=_env_bool("ALLOW_TRADE_ON_CLOCK_ERROR", True),
         trading_paused=_env_bool("TRADING_PAUSED", False),  # kill switch
         dry_run=_env_bool("DRY_RUN", False),
     )
@@ -187,9 +189,12 @@ def _market_gate_sleep_seconds(tc: TradingClient, cfg: Cfg) -> Optional[int]:
     try:
         clock = tc.get_clock()
     except Exception as e:
-        # fail-open: availability beats perfect gating; other risk guards still apply
-        LOG.warning("market_gate | clock_error=%s | allow_trade", e)
-        return None
+        if cfg.allow_trade_on_clock_error:
+            # fail-open: availability beats perfect gating; other risk guards still apply
+            LOG.warning("market_gate | clock_error=%s | allow_trade", e)
+            return None
+        LOG.error("market_gate | clock_error=%s | block_trade", e)
+        return max(10, int(cfg.poll_seconds))
 
     if getattr(clock, "is_open", False):
         return None
@@ -337,11 +342,12 @@ def select_signals(engine, cfg: Cfg, signals: List[dict]) -> Tuple[List[dict], i
 def risk_guard(tc: TradingClient, cfg: Cfg) -> Tuple[bool, str]:
     positions = tc.get_all_positions()
     open_orders = tc.get_orders(GetOrdersRequest(status=QueryOrderStatus.OPEN, limit=500))
+    open_orders_for_limit = [o for o in open_orders if not str(getattr(o, 'client_order_id', '') or '').startswith('exit-oco-')]
 
     if len(positions) >= cfg.max_open_positions:
         return False, f"max_open_positions_reached:{len(positions)}/{cfg.max_open_positions}"
-    if len(open_orders) >= cfg.max_open_orders:
-        return False, f"max_open_orders_reached:{len(open_orders)}/{cfg.max_open_orders}"
+    if len(open_orders_for_limit) >= cfg.max_open_orders:
+        return False, f"max_open_orders_reached:{len(open_orders_for_limit)}/{cfg.max_open_orders} (raw={len(open_orders)})"
 
     if cfg.enable_daily_risk_guard:
         try:
@@ -508,13 +514,13 @@ def main() -> None:
         "signal_executor starting | MIN_STRENGTH=%.4f | SYMBOLS=%s | PORTFOLIO_ID=%s | POLL=%ss | "
         "ALLOW_SHORT=%s | LONG_ONLY=%s | MAX_NOTIONAL=%.2f | MAX_QTY=%s | MAX_POSITION_QTY=%s | ALLOW_ADD_TO_POSITION=%s | "
         "ALPACA_DEDUPE_MINUTES=%s | CANCEL_OPPOSITE_OPEN_ORDERS=%s | MAX_OPEN_POSITIONS=%s | MAX_OPEN_ORDERS=%s | DAILY_LOSS_STOP_PCT=%.1f | "
-        "MAX_DAILY_LOSS_USD=%.1f | ENABLE_DAILY_RISK_GUARD=%s | SYMBOL_COOLDOWN_SECONDS=%s | PICK_TTL_SECONDS=%s | TRADE_ONLY_WHEN_MARKET_OPEN=%s | PREOPEN_WINDOW_SECONDS=%s | "
+        "MAX_DAILY_LOSS_USD=%.1f | ENABLE_DAILY_RISK_GUARD=%s | SYMBOL_COOLDOWN_SECONDS=%s | PICK_TTL_SECONDS=%s | TRADE_ONLY_WHEN_MARKET_OPEN=%s | PREOPEN_WINDOW_SECONDS=%s | ALLOW_TRADE_ON_CLOCK_ERROR=%s | "
         "TRADING_PAUSED=%s | DRY_RUN=%s",
         cfg.min_strength, cfg.symbols, cfg.portfolio_id, cfg.poll_seconds,
         cfg.allow_short, cfg.long_only, cfg.max_notional, cfg.max_qty, cfg.max_position_qty, cfg.allow_add_to_position,
         cfg.alpaca_dedupe_minutes, cfg.cancel_opposite_open_orders, cfg.max_open_positions, cfg.max_open_orders,
         cfg.daily_loss_stop_pct, cfg.max_daily_loss_usd, cfg.enable_daily_risk_guard,
-        cfg.symbol_cooldown_seconds, cfg.pick_ttl_seconds, cfg.trade_only_when_market_open, cfg.preopen_window_seconds, cfg.trading_paused, cfg.dry_run
+        cfg.symbol_cooldown_seconds, cfg.pick_ttl_seconds, cfg.trade_only_when_market_open, cfg.preopen_window_seconds, cfg.allow_trade_on_clock_error, cfg.trading_paused, cfg.dry_run
     )
 
     while True:
